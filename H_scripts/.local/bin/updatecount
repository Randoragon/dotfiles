#!/bin/bash

# Small Arch Linux script that prints the number of pending updates,
# saves the number in a small text file
# and uses polybar formatting to pass fg and bg colors.
# Tints it yellow normally, or sea-green if there's a linux kernel update.
# Deps: pacman-contrib

#!/bin/sh

# Fetches the number of pacman updates (official repositories)
# and if non 0, saves the number in FILE.

FILE="$HOME/.cache/updatecount"

# Create directory in case it doesn't exist
mkdir -p -- "$(dirname -- "$FILE")"

UPDATES="$(checkupdates)"

[ -z "$UPDATES" ] && {
    echo '' > "$FILE"
} || {
    COUNT="$(printf -- "$UPDATES\n" | wc -l)"
    FG="ffff00"
    BG="222200"
    [ ! -z "$(printf -- "$UPDATES" | grep -Po '^linux ')" ] && { FG="00ffaa" BG="003311"; }
    OUTPUT="%{B#$BG}%{F#$FG} Updates: $COUNT %{F- B-}"
    echo "$OUTPUT" > "$FILE"
    echo "Updates: $COUNT"
}

