#!/bin/sh

# Small Arch Linux script that prints the number of pending updates,
# saves the number in a small text file
# and uses polybar formatting to pass fg and bg colors.
# Tints it yellow normally, or sea-green if there's a linux kernel update.
# Deps: pacman-contrib

FILE="$HOME/.cache/updatecount"

# Create directory in case it doesn't exist
mkdir -p -- "$(dirname -- "$FILE")"

UPDATES="$(checkupdates)"

if [ -z "$UPDATES" ]; then
    echo '' > "$FILE"
else
    COUNT="$(printf "%s\n" "$UPDATES" | wc -l)"
    FG="ffff00"
    BG="222200"
    printf "%s" "$UPDATES" | grep -q '^linux ' && { FG="00ffaa" BG="003311"; }
    OUTPUT="%{B#$BG}%{F#$FG} Updates: $COUNT %{F- B-}"
    echo "$OUTPUT" > "$FILE"
    echo "Updates: $COUNT"
fi

