#!/usr/bin/env python3

# This script creates a new m3u playlist and adds adequate entries to the playlists.csv file
# to make other scripts work with the new playlist out of the box.

import os
import sys

HOME_DIR = os.path.expanduser('~')
CSV_FILE = f'{HOME_DIR}/.config/rofi/playlists.csv'
ADD_SCRIPT = 'pladdcurrent'
PLAYLIST_DIR = '~/Music/Playlists/' # the tilde here is deliberate

def rprint(msg):
    return os.system('rofi -e "{}" -markup'.format(msg))

def file_exists(path):
    try:
        open(path, 'r').close()
        return True
    except:
        return False

if __name__ == '__main__':
    if len(sys.argv) != 2:
        rprint('<i>E: plnew:</i> <b>Exactly one parameter required (received {})</b>'.format(len(sys.argv)-1))
        sys.exit(1)
    
    plname = str(sys.argv[1])
    playlist = PLAYLIST_DIR + plname + '.m3u'
    if not file_exists(os.path.expanduser(playlist)):
        os.system('touch {}'.format(playlist))
        f = open(CSV_FILE, 'a')
        f.write(f'{plname},{ADD_SCRIPT} {playlist}\n')
        f.close()
        sys.exit(0)
    else:
        print('plnew: This playlist already exists!')
        rprint('<i>W: plnew:</i> <b>This playlist already exists!</b>')
        sys.exit(1)
